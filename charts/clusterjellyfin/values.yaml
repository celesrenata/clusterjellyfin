# Default values for clusterjellyfin
image:
  jellyfin:
    repository: ghcr.io/celesrenata/clusterjellyfin-main
    tag: latest
    pullPolicy: IfNotPresent
  worker:
    repository: ghcr.io/celesrenata/clusterjellyfin-worker
    tag: latest
    pullPolicy: IfNotPresent

jellyfin:
  # Main Jellyfin instance configuration
  replicas: 1
  resources:
    requests:
      cpu: 1000m
      memory: 2Gi
    limits:
      cpu: 2000m
      memory: 4Gi
  
  # Jellyfin configuration
  publishedServerUrl: "https://jellyfin.celestium.life"
  
  # Storage configuration
  storage:
    config:
      size: 10Gi
      storageClass: ""
      accessMode: ReadWriteOnce
    cache:
      size: 50Gi
      storageClass: ""
      accessMode: ReadWriteOnce
    media:
      size: 1Ti
      storageClass: ""
      accessMode: ReadWriteMany
      nfs:
        server: "192.168.42.8"
        path: "/volume1/Plex"

workers:
  # Worker nodes for distributed transcoding
  replicas: 3
  resources:
    requests:
      cpu: 2000m
      memory: 4Gi
    limits:
      cpu: 4000m
      memory: 8Gi
  
  # Node selection for workers (nodes with Intel Arc GPUs)
  nodeSelector:
    enabled: true
    nodes:
      - gremlin-2
      - gremlin-3
  
  # Intel GPU resource requests
  gpu:
    enabled: true
    resource: "gpu.intel.com/i915"
    limit: 1

rffmpeg:
  # rffmpeg configuration
  config:
    logging:
      debug: true
    fallback:
      allow: true
    ssh:
      user: "ubuntu"
      options: "-i /config/.ssh/id_rsa -o StrictHostKeyChecking=no"

service:
  type: ClusterIP
  port: 8096
  httpsPort: 8920

ingress:
  enabled: true
  className: ""
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web
    traefik.ingress.kubernetes.io/router.middlewares: default-redirectscheme@kubernetescrd
  hosts:
    - host: jellyfin.celestium.life
      paths:
        - path: /
          pathType: Prefix
  tls:
    - hosts:
        - jellyfin.celestium.life
      secretName: jellyfin-cert
  httpsAnnotations:
    traefik.ingress.kubernetes.io/router.entrypoints: websecure
    cert-manager.io/cluster-issuer: ca-issuer

# Security context
securityContext:
  runAsUser: 1001
  runAsGroup: 1001
  fsGroup: 1001

# Namespace
namespace: jellyfin
